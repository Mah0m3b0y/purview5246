{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.5.6.12127",
      "templateHash": "7156223572060489949"
    }
  },
  "variables": {
    "location": "[resourceGroup().location]",
    "subscriptionId": "[subscription().subscriptionId]",
    "resourceGroupName": "[resourceGroup().name]",
    "rdPrefix": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions', variables('subscriptionId'))]",
    "role": {
      "PurviewDataCurator": "[format('{0}/8a3c2885-9b38-4fd2-9d99-91af537c1347', variables('rdPrefix'))]",
      "PurviewDataReader": "[format('{0}/ff100721-1b9d-43d8-af52-42b69c1272db', variables('rdPrefix'))]",
      "PurviewDataSourceAdministrator": "[format('{0}/200bba9e-f0c8-430f-892b-6f0794863803', variables('rdPrefix'))]",
      "StorageBlobDataReader": "[format('{0}/2a2b9908-6ea1-4ae2-8e65-a410df84e7d1', variables('rdPrefix'))]",
      "StorageBlobDataContributor": "[format('{0}/ba92f5b4-2d11-453d-a403-e96b0029c9fe', variables('rdPrefix'))]",
      "Contributor": "[format('{0}/b24988ac-6180-42a0-ab88-20f7382dd24c', variables('rdPrefix'))]",
      "Owner": "[format('{0}/8e3af657-a8ff-443c-a75c-2fe8c4bcb635', variables('rdPrefix'))]",
      "UserAccessAdministrator": "[format('{0}/18d7d88d-d35e-4fb5-a5c3-7773c20a72d9', variables('rdPrefix'))]"
    },
    "sqlAdminLogin": "asa",
    "sqlSecretName": "abc",
    "vaultUri": "https://pvdemo6uqbt-keyvault.vault.azure.net/",
    "sqlServerName": "mysqlserver",
    "sqlDatabaseName": "mydatabase"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/deploymentScripts",
      "apiVersion": "2020-10-01",
      "name": "script",
      "location": "[variables('location')]",
      "kind": "AzurePowerShell",
      "properties": {
        "azPowerShellVersion": "7.2",
        "arguments": "[format('-subscriptionId {0} -resourceGroupName {1} -accountName {2} -objectId {3} -sqlAdminLogin {4} -sqlSecretName {5} -vaultUri {6} -sqlServerName {7} -location {8} -sqlDatabaseName {9}', variables('subscriptionId'), variables('resourceGroupName'), 'pvdemo6uqbt-pv', reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'configDeployer'), '2018-11-30').principalId, variables('sqlAdminLogin'), variables('sqlSecretName'), variables('vaultUri'), variables('sqlServerName'), variables('location'), variables('sqlDatabaseName'))]",
        "primaryScriptUri": "https://raw.githubusercontent.com/tayganr/purviewdemo/main/temp/script20.ps1",
        "forceUpdateTag": "[guid(resourceGroup().id)]",
        "retentionInterval": "PT4H"
      },
      "identity": {
        "type": "UserAssigned",
        "userAssignedIdentities": {
          "[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'configDeployer'))]": {}
        }
      }
    }
  ]
}